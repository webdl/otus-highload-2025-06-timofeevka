# RabbitMQ Configuration with Streams enabled

# Stream protocol configuration
stream.listeners.tcp.1 = 0.0.0.0:5552
stream.tcp_listen_options.backlog = 4096
stream.tcp_listen_options.recbuf = 131072
stream.tcp_listen_options.sndbuf = 131072
stream.tcp_listen_options.keepalive = true
stream.tcp_listen_options.nodelay = true
stream.tcp_listen_options.exit_on_close = true
stream.tcp_listen_options.send_timeout = 120

# Stream defaults
stream.initial_credits = 50000
stream.credits_required_for_unblocking = 12500
stream.frame_max = 1048576
stream.heartbeat = 60
stream.advertised_host = rabbitmq
stream.advertised_port = 5552

# Performance tuning
vm_memory_high_watermark.relative = 0.6
vm_memory_high_watermark_paging_ratio = 0.75
disk_free_limit.absolute = 2GB

# Management and monitoring
management.load_definitions = /etc/rabbitmq/definitions.json
management_agent.disable_metrics_collector = false
management.disable_stats = false

# Prometheus metrics
prometheus.return_per_object_metrics = true
prometheus.tcp.port = 15692

# Log configuration
log.console = true
log.console.level = info
log.file.level = debug
log.file = /var/log/rabbitmq/rabbit.log

# Clustering
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config
cluster_formation.classic_config.nodes.1 = rabbit@rabbitmq

# Queue and message TTL
consumer_timeout = 3600000
max_message_size = 134217728
